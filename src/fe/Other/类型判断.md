# ç±»å‹åˆ¤æ–­

## 1. typeof

```js
console.log(typeof null) // object
console.log(typeof []) // object
console.log(typeof new RegExp(/A/)) // object
console.log(typeof function () {}) // function
```

å¦‚ä¸Šï¼Œé’ˆå¯¹å¼•ç”¨æ•°æ®ç±»å‹ï¼Œ`typeof` æ— æ³•å¾ˆå¥½çš„åŒºåˆ†å„ `object`ã€‚

## 2. Object.prototype.toString.call()

- **åŸºæœ¬ç±»å‹çš„å°è£…å¯¹è±¡**ï¼š

  ```js
  Object.prototype.toString.call(1);               // "[object Number]"
  Object.prototype.toString.call('hello');         // "[object String]"
  Object.prototype.toString.call(true);            // "[object Boolean]"
  ```

- **å¸¸è§å†…ç½®å¯¹è±¡**ï¼š

  ```js
  Object.prototype.toString.call([]);              // "[object Array]"
  Object.prototype.toString.call({});              // "[object Object]"
  Object.prototype.toString.call(new Date());      // "[object Date]"
  Object.prototype.toString.call(/regex/);         // "[object RegExp]"
  Object.prototype.toString.call(new Map());       // "[object Map]"
  Object.prototype.toString.call(new Set());       // "[object Set]"
  Object.prototype.toString.call(function() {});   // "[object Function]"
  ```

- **ç‰¹æ®Šå€¼**ï¼š

  ```js
  Object.prototype.toString.call(null);            // "[object Null]"
  Object.prototype.toString.call(undefined);       // "[object Undefined]"
  ```

- **Symbol**ï¼š

  ```js
  Object.prototype.toString.call(Symbol());        // "[object Symbol]"
  ```

> ğŸ“¢ å…³äº `Object.prototype.toString.call(1) === [object Number]`
>
> - **åŸºæœ¬ç±»å‹å°è£…**ï¼šå¯¹äºåŸºæœ¬ç±»å‹ï¼ˆå¦‚æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ï¼Œå®ƒä»¬åœ¨è°ƒç”¨ `Object.prototype.toString` æ–¹æ³•æ—¶ä¼šè¢«å°è£…ä¸ºç›¸åº”çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œæ•°å­—ä¼šè¢«å°è£…ä¸º `Number` å¯¹è±¡ï¼‰ã€‚
> - **è·å–ç±»å‹æ ‡ç­¾**ï¼š`Object.prototype.toString` æ–¹æ³•ä¼šæ£€æŸ¥å¯¹è±¡çš„å†…éƒ¨ `[[Class]]` å±æ€§ï¼Œè¯¥å±æ€§æ˜¯ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºå¯¹è±¡ç±»å‹çš„å†…éƒ¨æ ‡ç­¾ï¼ˆå¹¶éç›´æ¥å¯è®¿é—®çš„å±æ€§ï¼‰ã€‚
> - è¿”å›æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š`Object.prototype.toString` æ–¹æ³•ä¼šæ ¹æ®è¿™ä¸ªå°è£…åçš„å¯¹è±¡çš„ `[[Class]]` å±æ€§æ¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸º `"[object Type]"`ï¼Œå…¶ä¸­ `Type` æ˜¯å¯¹è±¡çš„ç±»å‹ã€‚

`Object.prototype.toString.call()` å¯ä»¥åŒºåˆ†å„ `object`ï¼Œä½†åªèƒ½æ ¡éªŒå·²ç»å­˜åœ¨çš„ç±»å‹ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰ç±»å‹ã€‚

```js
class A {}
const a = new A()
console.log(Object.prototype.toString.call(a)) // [object Object]ï¼Œä½†å®é™…ä¸Š a çš„ ç±»å‹ä¸º A
```

## 3. instanceof

ä¸ºäº†æ”¯æŒæ ¡éªŒè‡ªå®šä¹‰ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ instanceofã€‚

```js
class A {}
const a = new A()
console.log(a instanceof A) // true

console.log([] instanceof Array) // true
console.log([] instanceof Object) // true
```

ç›¸å½“äº

```js
console.log([].__proto__ === Array.prototype) // true
console.log([].__proto__.__proto__ === Object.prototype) // true
```

åŸºäºæ­¤ï¼Œå¯ä»¥è‡ªå·±å®ç° `instanceof`

```js
function _instanceof (A, B) {
  A = A.__proto__
  B = B.prototype
  while (true) {
    if (A === null) { // Object.prototype.__proto__ === null
      return false
    }
    if (A === B) {
      return true
    }
    A = A.__proto__
  }
}

console.log(_instanceof(a, A)) // true
console.log(_instanceof(a, Object)) // true
console.log(_instanceof(a, Array)) // false
```

ä½†æ˜¯ï¼Œ`instanceof` æ— æ³•æ ¡éªŒåŸºç¡€æ•°æ®ç±»å‹

```js
console.log('str' instanceof String) // falseï¼Œåº”ä¸º true
```

ä¸Šè¿°ç¤ºä¾‹ï¼Œ`instanceof` åœ¨ä½¿ç”¨æ—¶é»˜è®¤ä¼šè°ƒç”¨ `String` çš„ `Symbol.hasInstance` æ–¹æ³•è¿›è¡Œæ ¡éªŒï¼Œæ‰€ä»¥ä¸Šè¿°å†™æ³•ç­‰ä»·äº

```js
console.log(String[Symbol.hasInstance]('str')) // false
```

æ‰€ä»¥ï¼Œå¯ä»¥å¯¹ `Symbol.hasInstance` è¿›è¡Œé‡å†™ï¼Œä»¥æ”¯æŒåŸºç¡€æ•°æ®ç±»å‹

```js
class ValidateStr {
  static [Symbol.hasInstance] (x) {
    return typeof x === 'string'
  }
}
console.log(ValidateStr[Symbol.hasInstance]('str')) // true
console.log('str' instanceof ValidateStr) // true
```

## 4. ç±»å‹æ£€æµ‹å‡½æ•°

- æ–¹æ³•1ï¼š

  ```js
  function getType(value) {
      // ä½¿ç”¨ Object.prototype.toString.call å¤„ç†æ‰€æœ‰ç±»å‹
      const type = Object.prototype.toString.call(value).slice(8, -1).toLowerCase();
  
      // æ£€æŸ¥å¯¹è±¡ç±»å‹å’Œå‡½æ•°ç±»å‹
      if ((type === 'object' || type === 'function') && value.constructor) {
          const constructorName = value.constructor.name;
          if (constructorName !== 'Object' && constructorName !== 'Function') {
              return constructorName;
          }
      }
      return type;
  }
  
  // æµ‹è¯•åŸºæœ¬ç±»å‹å’Œå†…ç½®ç±»å‹
  console.log(getType(1)); // "number"
  console.log(getType('hello')); // "string"
  console.log(getType(true)); // "boolean"
  console.log(getType(undefined)); // "undefined"
  console.log(getType(null)); // "null"
  console.log(getType([])); // "array"
  console.log(getType({})); // "object"
  console.log(getType(function() {})); // "function"
  console.log(getType(new Date())); // "date"
  console.log(getType(/regex/)); // "regexp"
  
  // å®šä¹‰è‡ªå®šä¹‰ç±»
  class A {}
  const a = new A();
  
  // æµ‹è¯•è‡ªå®šä¹‰ç±»å‹
  console.log(getType(a)); // "A"
  ```

- æ–¹æ³•2ï¼š

  æ¯ä¸ªå¯¹è±¡çš„ `constructor` å±æ€§æŒ‡å‘åˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥å¯¹è±¡çš„ `constructor` å±æ€§æ¥ç¡®å®šå¯¹è±¡çš„ç±»å‹ã€‚å¯¹äºå†…ç½®ç±»å‹å’Œè‡ªå®šä¹‰ç±»å‹ï¼Œè¿™ç§æ–¹æ³•éƒ½å¾ˆæœ‰æ•ˆã€‚

  å¯¹ `null` å’Œ `undefined` è¿›è¡Œå•ç‹¬å¤„ç†ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰ `constructor` å±æ€§ã€‚

  ```js
  function getType(value) {
      if (value === null) {
          return 'null';
      }
      if (value === undefined) {
          return 'undefined';
      }
      return value.constructor.name;
  }
  
  // æµ‹è¯•åŸºæœ¬ç±»å‹å’Œå†…ç½®ç±»å‹
  console.log(getType(1)); // "Number"
  console.log(getType('hello')); // "String"
  console.log(getType(true)); // "Boolean"
  console.log(getType(undefined)); // "undefined"
  console.log(getType(null)); // "null"
  console.log(getType([])); // "Array"
  console.log(getType({})); // "Object"
  console.log(getType(function() {})); // "Function"
  console.log(getType(new Date())); // "Date"
  console.log(getType(/regex/)); // "RegExp"
  
  // å®šä¹‰è‡ªå®šä¹‰ç±»
  class A {}
  const a = new A();
  
  // æµ‹è¯•è‡ªå®šä¹‰ç±»å‹
  console.log(getType(a)); // "A"
  ```

  ç¼ºé™·ï¼š

  åœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡çš„ `constructor` å±æ€§é€šå¸¸æŒ‡å‘åˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ”¹å˜äº†å¯¹è±¡çš„åŸå‹é“¾ï¼Œè¿™ä¸ª `constructor` å±æ€§å¯èƒ½ä¼šè¢«æ”¹å˜æˆ–è€…ä¸å†æŒ‡å‘åŸå§‹æ„é€ å‡½æ•°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡ `constructor` å±æ€§è·å–ç±»å‹ä¿¡æ¯å¯èƒ½ä¼šå˜å¾—ä¸å¯é ã€‚

  ```js
  // é»˜è®¤æƒ…å†µä¸‹ï¼Œconstructor å±æ€§æ­£ç¡®æŒ‡å‘æ„é€ å‡½æ•°
  class A {}
  const a = new A();
  console.log(a.constructor === A); // true
  
  // æ‰‹åŠ¨æ”¹å˜åŸå‹é“¾åï¼Œconstructor å±æ€§è¢«æ”¹å˜
  class B {}
  a.__proto__ = B.prototype; // æ”¹å˜ a çš„åŸå‹é“¾
  console.log(a.constructor === A); // false
  console.log(a.constructor === B); // true
  
  
  ```

  ä¸ºäº†æé«˜ `getType` å‡½æ•°çš„å¯é æ€§ï¼Œæ¨èä½¿ç”¨ `Object.prototype.toString` æ–¹æ³•ä½œä¸ºä¸»è¦çš„ç±»å‹æ£€æµ‹æ‰‹æ®µï¼ˆ**æ–¹æ³•1**ï¼‰ï¼Œå› ä¸ºå®ƒä¸ä¼šå—åˆ°åŸå‹é“¾ä¿®æ”¹çš„å½±å“ã€‚

